# My First Post


## Analyzed sample

The sample used in this analysis is publicly available on tria.ge.\
***SHA256:*** 182d47c2c09fa29a48a46781da49a07967e1136708ba28e1acaca92858b05a16.\
***Link:*** https://tria.ge/220716-j58k1aaec4

## Lab Setup

The Lab used in this analysis is composed of a Windows machine and a Remnux host.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img1.png "MarineGEO logo")


> - The default gateway on the windows machine is 192.168.234.129
> - Remnux has Inetsim, FakeDns and Wireshark configured and running.
> - Remnux can intercept all incoming traffic.


## Static Analysis
#### 1. Peframe
Using Peframe, a non-common section name ***$u*** and few interesting API call have been
identified.
![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img2.png "MarineGEO logo")
![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img3.png "MarineGEO logo")

#### 2. PeStudio
PeStudi was able to identify suspicious artifacts like the non-common, writable & executable
section ***$u***. 
The use of potentially suspicious Windows API functions and embedded file in section ***$u***.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img4.png "MarineGEO logo")
![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img5.png "MarineGEO logo")
![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img6.png "MarineGEO logo")
![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img7.png "MarineGEO logo")


#### 3. DIE
Detect it easy, suggests that this malware is not packed.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img8.png "MarineGEO logo")

## Behavioral Analysis
#### 1. ProcDot analysis
Below all the interactions done by the malware on the OS.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img9.png "MarineGEO logo")

> - Persistence method\
The malware sets the following run key:
HKLM\System\CurrentControlSet\Services\bam\State\UserSettings\S-1-5-21-201960391-10506
06829-3220342080-1001\Device\HarddiskVolume3\Users\WindowsRM\Desktop\Samples\sampl
e_gw.exe

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img10.png "MarineGEO logo")

> - Dropper behavior\
The analyzed specimen, drops an executable file on the system and launch it
Dropped filename: C:\411b3d06.exe

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img11.png "MarineGEO logo")

This matches the observation using Process Hacker.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img12.png "MarineGEO logo")

The dropped file, creates and sets a new bat file.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img13.png "MarineGEO logo")

In addition, the dropped exe file, tries to bypass all proxy settings on the infected machine.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img14.png "MarineGEO logo")

Another observed interesting behavior, is the creation of 5 executable files under the TEMP folder.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img15.png "MarineGEO logo")

The dropped speciem, infects all the executable files on the host.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img16.png "MarineGEO logo")

#### 2. Network traffic analysis
Right after executing the malware, a DNS request for the domain 1.dnsnb8[.]net was observed.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img17.png "MarineGEO logo")

In wireshark, TCP connections towards the same domain on port 799 was observed. After
reconfiguring the TCP simulation on Inetsim to accept incoming traffic on port 799, wireshark
was able to catch HTTP requests to download .rar files.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img18.png "MarineGEO logo")

The malware was aiming to drop the following files:

http://1.dnsnb8[.]net:799/cj/k1.rar

http://1.dnsnb8[.]net:799/cj/k2.rar

http://1.dnsnb8[.]net:799/cj/k3.rar

http://1.dnsnb8[.]net:799/cj/k4.rar

http://1.dnsnb8[.]net:799/cj/k5.rar

This was confirmed by Inetsim reports

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img19.png "MarineGEO logo")

Fiddler client on the windows host was able to catch the same HTTP traffic:

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img20.png "MarineGEO logo")

These 5 rar files could be linked to the 5 executables generated by the dropped specimen
***C:\411b3d06.exe***


## Dynamic Analysis

During a brief analysis using x32gdb debugger, the behavior of the malware has been
confirmed. The created of the file with the name 411b3d06.exe has been observed at runtime.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img21.png "MarineGEO logo")

The specimen was observed checking its original filename and compare it to Remove.
If the file is called Remove.exe, the malware will display a message box to the user saying:
“This program is normally started by windows”. If not, the program will just display “Setup
program invalid or damaged”.

![MarineGEO circle logo](https://raw.githubusercontent.com/khouloudS/blogs/main/img22.png "MarineGEO logo")

The filename has no impact on the behavior of the malware.

## IOCs

| Type      | Value |
| :---        |    :---     |        
| sha1      | 2fac3856507d08bd8264d2bd858e8b0c91b873dc       |
| sha256   | 182d47c2c09fa29a48a46781da49a07967e1136708ba28e1acaca92858b05a16        |     
| imphash   | 89AD82854409B9DD81837C899D65F03E        |     
| Dropped files |182d47c2c09fa29a48a46781da49a07967e1136708ba28e1acaca92858b05a16        |     
| Domain   | 1.dnsnb8[.]net        |  
|HTTP connections| http://1.dnsnb8[.]net:799/cj/k1.rar<br/> http://1.dnsnb8[.]net:799/cj/k2.rar <br/> http://1.dnsnb8[.]net:799/cj/k3.rar <br/>  http://1.dnsnb8[.]net:799/cj/k4.rar <br/> http://1.dnsnb8[.]net:799/cj/k5.rar|   
| User Agent | Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)|







